<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test 1 Swapps</title>
    <link rel="icon" href="assets/images/icon.jpg" type="image/jpg">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">

    <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>
    <div id="app">
        <div class="card mt-4 ms-md-5" style="width: 35rem;">
            <div class="card-body">
                <h5 class="card-title">Test 1.</h5>
                <h6 class="card-subtitle mb-2">API usage test</h6>
                <p class="card-text">You can search books by name and/or by author.</p>

                <form class="mb-3">
                    <div class="row mb-2">
                        <div class="col-md-2">
                            <label for="book" class="form-label">Book: </label>
                        </div>
                        <div class="col-md-10">
                            <input v-model="book" type="text" class="form-control" id="book">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-2">
                            <label for="author" class="form-label">Author: </label>
                        </div>
                        <div class="col-md-10">
                            <input v-model="author" type="text" class="form-control" id="author">
                        </div>
                    </div>
                </form>
                <div class="row">
                    <div class="col-md-4">
                        <a href="#" v-on:click="search" class="w-100 card-link btn btn-primary">Search</a>
                    </div>
                    <div class="col-md-4">
                        <a href="#" v-on:click="clear" class="w-100 card-link btn btn-danger">Clear</a>
                    </div>
                </div>
            </div>
        </div>
        <div v-if="loading" class="card mt-2 ms-md-5" style="width: 35rem;">
            <div class="card-body">
                <img src="assets/images/spinner.gif" alt="" style="width: -webkit-fill-available;">
            </div>
        </div>

        <div v-if="totalResults != 0" class="card ms-md-5 mt-2 w-90">
            <div class="card-body">
                <h4 class="card-title">
                    It founds {{totalResults}} results
                </h4>
                <table class="table table-light table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Author</th>
                            <th>First Publish Year</th>
                            <th>Actual Edition</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="result in results">
                            <td>{{result.title}}</td>
                            <td>{{result.author_name}}</td>
                            <td>{{result.first_publish_year}}</td>
                            <td>{{result.edition_count}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</body>

<script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.2/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>

    new Vue({
        el: "#app",
        data: {
            book: "",
            author: "",
            results: [],
            loading: false
        },
        methods: {
            search:  async function () {
                if (this.book == "" && this.author == "") {
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        html: 'There is nothing to search! <br> Enter a book name and/or an author.',
                    })
                    return;
                }
                this.loading = true;

                const paramBook = (this.book != "") ? "title=" + this.book : "";
                const join = (this.book != "" && this.author != "") ? "&" : "";
                const paramAuthor = (this.author != "") ? "author=" + this.author : "";

                const url = "http://openlibrary.org/search.json?" + paramBook + join + paramAuthor;
                console.log(url);
                await axios.get(url).then(response => {
                    this.results = response.data.docs;
                }).catch(function (error) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        html: 'There is a problem comunicating with the server',
                    }).then((result) => {
                    })
                    console.log(error.response);
                })
                this.loading = false;

            },
            clear: function () {
                this.book = "";
                this.author = "";
                this.results = [];
                this.loading = false;
            }

        },
        computed: {
            totalResults: function () {
                return this.results.length
            }
        }
    })
</script>

</html>